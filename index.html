<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Pink Sanctuary: Gentle Guide</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Tailwind configuration for the warm pink theme (Pink Shades)
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'soft-pink': '#FFEBF0', // Very light background
                        'medium-pink': '#F472B6', // Medium pink for icons
                        'dark-pink': '#9D174D', // Dark pink for headings
                        'accent-pink': '#DB2777', // Strong pink for action buttons
                    },
                    fontFamily: {
                        sans: ['Inter', 'Arial', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FFEBF0; /* soft-pink */
        }
        /* Ensure content takes up min-height considering the fixed bottom bar */
        .view-content {
            min-height: calc(100vh - 80px); 
        }
        /* Simple shadow effect for the active navigation button */
        .nav-btn.active {
            box-shadow: 0 0 10px rgba(219, 39, 119, 0.3);
        }
    </style>
</head>
<body class="min-h-screen">
    <div id="app" class="flex flex-col min-h-screen max-w-lg mx-auto shadow-xl bg-white border-x border-pink-200">
        <!-- Header -->
        <header class="p-4 bg-accent-pink text-white shadow-md">
            <h1 class="text-xl font-bold text-center">My Pink Sanctuary: Gentle Guide 💖</h1>
        </header>

        <!-- Main Content Area -->
        <main id="main-content" class="flex-grow p-4 overflow-y-auto view-content">
            <div id="loading-screen" class="flex justify-center items-center h-full text-lg text-dark-pink">
                Loading...
            </div>
            <div id="content-views" class="hidden">
                <!-- Content for Reminders, Journal, or Overthinking will be loaded here -->
            </div>
        </main>

        <!-- Navigation Bar -->
        <nav class="sticky bottom-0 w-full bg-white border-t border-pink-300 shadow-2xl flex justify-around p-2">
            <!-- 1. Reminders Section -->
            <button onclick="switchView('reminders')" id="nav-reminders" class="nav-btn flex flex-col items-center p-2 rounded-xl text-pink-400 hover:bg-pink-100 transition-colors active">
                <!-- Clock Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span class="text-xs mt-1">Reminders</span>
            </button>
            <!-- 2. Journal Section -->
            <button onclick="switchView('journal')" id="nav-journal" class="nav-btn flex flex-col items-center p-2 rounded-xl text-pink-400 hover:bg-pink-100 transition-colors">
                <!-- Journal Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.468 9.24 5.235 7.92 5.517c-2.613.565-3.89 2.222-3.692 4.614.288 3.393 2.766 5.62 5.394 5.62 3.1 0 5.48-1.543 5.48-5.748V6.253z" />
                </svg>
                <span class="text-xs mt-1">My Journal</span>
            </button>
            <!-- 3. Anti-Overthinking Section -->
            <button onclick="switchView('overthinking')" id="nav-overthinking" class="nav-btn flex flex-col items-center p-2 rounded-xl text-pink-400 hover:bg-pink-100 transition-colors">
                <!-- Brain/Stop Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 18h.01M17 6H7a4 4 0 00-4 4v4a4 4 0 004 4h10a4 4 0 004-4v-4a4 4 0 00-4-4z" />
                </svg>
                <span class="text-xs mt-1">Anti-Overthinking</span>
            </button>
        </nav>

        <!-- Custom Message/Modal Area (Replacing native alerts) -->
        <div id="message-area" class="fixed top-0 left-0 w-full h-full bg-black bg-opacity-30 flex justify-center items-center p-4 z-50 hidden">
            <div id="message-box" class="bg-white p-6 rounded-2xl shadow-2xl max-w-xs w-full text-center border-4 border-accent-pink">
                <p id="message-text" class="text-lg font-semibold text-dark-pink"></p>
                <button onclick="hideMessage()" class="mt-4 bg-accent-pink text-white py-2 px-6 rounded-full font-bold hover:bg-pink-700 transition-colors">Got it</button>
            </div>
        </div>
        
        <!-- Bob Up Message Modal (The newly requested explanation) -->
        <div id="bob-up-modal" class="fixed top-0 left-0 w-full h-full bg-black bg-opacity-50 flex justify-center items-center p-4 z-50 hidden">
            <div class="bg-white p-6 rounded-3xl shadow-2xl max-w-sm w-full border-8 border-soft-pink">
                <h3 class="text-2xl font-bold text-accent-pink text-center mb-4">✨ The "Bob Up" Message ✨</h3>
                <p class="text-gray-700 leading-relaxed mb-4">
                    This section is specifically designed to store the **Awareness and Strength Thoughts** that come to you during your good times (your **Ups**).
                </p>
                <ul class="list-disc list-inside space-y-2 text-gray-600 ml-4">
                    <li>**Purpose:** Write down positive convictions about yourself here (e.g., I am capable, I am enough as I am, these are just thoughts and they will pass).</li>
                    <li>**Value:** These become your **Supportive Notes** that you can mark with "Remind Me" so the app sends you these messages when you need a positive boost (during your **Downs**).</li>
                </ul>
                <p class="mt-4 text-center font-bold text-dark-pink">
                    Use your strength today to support yourself tomorrow.
                </p>
                <button onclick="hideBobUpMessage()" class="mt-6 w-full bg-accent-pink text-white py-3 px-6 rounded-full font-bold hover:bg-pink-700 transition-colors transform hover:scale-105">Understood, I'll start writing!</button>
            </div>
        </div>

    </div>

    <!-- Firebase SDKs: for permanent data storage -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, collection, setDoc, addDoc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        // setLogLevel('Debug'); // Uncomment for debugging

        // Global variables provided by the environment (MANDATORY for data persistence)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        let db;
        let auth;
        let userId = 'loading';
        let journalEntries = []; // Local state for journal entries

        // --- Helper functions for messaging and Firestore path construction ---
        window.showMessage = (text) => {
            document.getElementById('message-text').innerHTML = text;
            document.getElementById('message-area').classList.remove('hidden');
        };

        window.hideMessage = () => {
            document.getElementById('message-area').classList.add('hidden');
        };
        
        window.showBobUpMessage = () => {
            document.getElementById('bob-up-modal').classList.remove('hidden');
        };

        window.hideBobUpMessage = () => {
            document.getElementById('bob-up-modal').classList.add('hidden');
        };

        // Private path for the user's journal entries
        const getJournalCollectionPath = (uid) => {
            return `artifacts/${appId}/users/${uid}/mental_wellness_data/journal_entries`;
        };
        
        // Private path for logging support requests
        const getRemindersCollectionPath = (uid) => {
            return `artifacts/${appId}/users/${uid}/mental_wellness_data/reminders_log`;
        };

        const getCurrentDateString = () => {
            const now = new Date();
            return now.toISOString().split('T')[0]; // YYYY-MM-DD
        };

        // --- Firebase Initialization and Authentication ---
        const initializeFirebase = async () => {
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // Sign in using custom token or anonymously
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

                // Wait for auth state confirmation
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        document.getElementById('loading-screen').classList.add('hidden');
                        document.getElementById('content-views').classList.remove('hidden');
                        
                        // Start Firestore listener and load default view
                        setupJournalListener();
                        switchView('reminders');
                        
                    } else {
                        document.getElementById('loading-screen').innerHTML = 'Authentication failed. Please try again.';
                    }
                });

            } catch (error) {
                console.error("Firebase initialization or auth error:", error);
                document.getElementById('loading-screen').innerHTML = 'Initialization error: ' + error.message;
            }
        };

        // --- 2. Journal Section: Save and Display Logic ---
        const setupJournalListener = () => {
            if (!db || userId === 'loading') return;

            const q = collection(db, getJournalCollectionPath(userId));
            
            // onSnapshot for real-time changes
            onSnapshot(q, (snapshot) => {
                journalEntries = [];
                snapshot.forEach(doc => {
                    journalEntries.push({
                        id: doc.id,
                        content: doc.data().content,
                        timestamp: doc.data().timestamp,
                        remind_me: doc.data().remind_me || false,
                    });
                });
                
                // Sort by date (newest first)
                journalEntries.sort((a, b) => b.timestamp - a.timestamp);
                
                // Update view if currently on the journal page
                if (window.currentView === 'journal') {
                    renderJournalView();
                }
                checkForReminders(); // Check for self-reminders
            }, (error) => {
                console.error("Error fetching journal entries:", error);
                showMessage("Failed to load journal entries. Check your connection.");
            });
        };
        
        const checkForReminders = () => {
            const today = getCurrentDateString();
            const lastReminderDate = localStorage.getItem('lastReminderDate');
            
            // Check only once per day to prevent annoyance
            if (lastReminderDate === today || journalEntries.length === 0) return;

            const remindingEntries = journalEntries.filter(e => e.remind_me);
            
            if (remindingEntries.length > 0) {
                const randomEntry = remindingEntries[Math.floor(Math.random() * remindingEntries.length)];
                showMessage(`
                    **A reminder from your Strong Self!**
                    <br><br>
                    You asked to be reminded of this wisdom:
                    <br>
                    "<span class="italic font-normal">${randomEntry.content.substring(0, 100)}...</span>"
                    <br><br>
                    Remember how far you've come and how much better you've become.
                `);
                localStorage.setItem('lastReminderDate', today);
            }
        };

        window.addJournalEntry = async () => {
            const textarea = document.getElementById('new-journal-content');
            const checkbox = document.getElementById('remind-me-checkbox');
            const content = textarea.value.trim();

            if (!content) {
                showMessage("Please, an empty note cannot be saved. Share your wisdom with me.");
                return;
            }

            try {
                await addDoc(collection(db, getJournalCollectionPath(userId)), {
                    content: content,
                    timestamp: Date.now(),
                    remind_me: checkbox.checked,
                });

                textarea.value = '';
                checkbox.checked = false;
                showMessage("Your Bob Up wisdom has been saved successfully! ✨");
            } catch (error) {
                console.error("Error adding journal entry:", error);
                showMessage("An error occurred during saving. (Check your connection)");
            }
        };
        
        window.deleteJournalEntry = async (docId) => {
             // Using a custom confirmation message instead of native confirm()
            const confirmation = window.confirm('Are you sure you want to delete this note? This action cannot be undone.'); 
            if (!confirmation) return; 
            
            try {
                const docRef = doc(db, getJournalCollectionPath(userId), docId);
                await deleteDoc(docRef);
                showMessage("Note deleted successfully.");
            } catch (error) {
                console.error("Error deleting journal entry:", error);
                showMessage("An error occurred during deletion.");
            }
        };
        
        window.toggleRemindMe = async (docId, currentState) => {
            try {
                const docRef = doc(db, getJournalCollectionPath(userId), docId);
                await updateDoc(docRef, {
                    remind_me: !currentState
                });
                showMessage(!currentState ? "Remind Me activated! I will remind you of this later." : "Reminder cancelled for this note.");
            } catch (error) {
                console.error("Error toggling remind me:", error);
                showMessage("An error occurred while updating the reminder.");
            }
        };

        const renderJournalView = () => {
            const journalContent = `
                <div id="journal-view" class="space-y-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-dark-pink">My Strength Journal (Bob Up) 📓</h2>
                        <button onclick="showBobUpMessage()" class="text-sm text-accent-pink hover:text-pink-700 font-medium flex items-center bg-pink-100 p-2 rounded-full transform hover:scale-105 transition-transform">
                             What is the Bob Up Message?
                        </button>
                    </div>
                    
                    <!-- New Entry Input -->
                    <div class="bg-white p-4 rounded-2xl shadow-lg border border-pink-300">
                        <textarea id="new-journal-content" rows="4" class="w-full p-3 border border-pink-200 rounded-lg focus:ring-accent-pink focus:border-accent-pink resize-none text-gray-700 placeholder:text-pink-300" placeholder="Write down the 'Awareness' wisdom you reached during your strong moments..."></textarea>
                        
                        <div class="flex justify-between items-center mt-3">
                            <label class="flex items-center text-dark-pink cursor-pointer">
                                <input type="checkbox" id="remind-me-checkbox" class="form-checkbox h-5 w-5 text-accent-pink rounded border-pink-300 focus:ring-accent-pink">
                                <span class="ml-2 text-sm font-medium">Remind me of this wisdom later</span>
                            </label>
                            <button onclick="addJournalEntry()" class="bg-accent-pink text-white py-2 px-4 rounded-full font-bold text-sm shadow-md hover:bg-pink-700 transition-colors transform hover:scale-105">
                                Save ✨
                            </button>
                        </div>
                    </div>

                    <!-- Saved Entries -->
                    <div id="journal-list" class="space-y-4">
                        <h3 class="text-xl font-semibold text-pink-600 border-b border-pink-300 pb-2">All your writings (${journalEntries.length})</h3>
                        ${journalEntries.length === 0 ? 
                            '<p class="text-center text-gray-500 mt-4">You have not written any awareness wisdom yet. Start now to protect your future self!</p>' :
                            journalEntries.map(entry => `
                                <div class="bg-soft-pink p-4 rounded-xl shadow-md border-l-4 ${entry.remind_me ? 'border-accent-pink' : 'border-pink-300'} relative">
                                    <p class="text-gray-800 whitespace-pre-wrap">${entry.content}</p>
                                    <div class="flex justify-between items-center text-xs text-gray-500 mt-3 border-t border-pink-200 pt-2">
                                        <span>${new Date(entry.timestamp).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' })}</span>
                                        <div class="flex space-x-2">
                                            <button onclick="toggleRemindMe('${entry.id}', ${entry.remind_me})" class="p-1 rounded-full text-sm ${entry.remind_me ? 'bg-accent-pink text-white' : 'bg-pink-200 text-pink-600'} transition-colors" title="${entry.remind_me ? 'Disable Reminder' : 'Enable Reminder'}">
                                                <!-- Reminder Icon (Bell) -->
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                </svg>
                                            </button>
                                            <button onclick="deleteJournalEntry('${entry.id}')" class="p-1 rounded-full text-sm bg-red-100 text-red-600 hover:bg-red-200 transition-colors" title="Delete">
                                                <!-- Delete Icon -->
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                                </svg>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')
                        }
                    </div>
                </div>
            `;
            document.getElementById('content-views').innerHTML = journalContent;
        };

        // --- 1. Reminders Section: Daily Messages and Instant Support Notifications ---
        const dailyReminders = [
            "You are strong, and these thoughts are just ideas, not facts. Take a breath.",
            "A small break today is a big step towards a better tomorrow. You deserve rest.",
            "Self-love begins with accepting this moment, with everything in it. You are enough as you are.",
            "There is no need for perfection. Today, it is enough that you did your best. And that is wonderful.",
            "Difficult things will pass, just as others have. Trust your power to overcome them.",
            "Remind yourself that you can ask for help. Strength is not in silence.",
            "Smile at yourself in the mirror. You deserve all the kindness you give to others.",
        ];

        // Choose a random message each time the app loads
        let currentDailyReminder = dailyReminders[Math.floor(Math.random() * dailyReminders.length)];

        window.requestSupport = async () => {
            try {
                // Log the support request in Firestore
                await addDoc(collection(db, getRemindersCollectionPath(userId)), {
                    type: 'SUPPORT_NEEDED',
                    timestamp: Date.now(),
                });
                
                // Show instant notification (simulation)
                showMessage("Your request for support has been logged. Remember: you are not alone, and you have taken a brave step! 💖");
                
                // Update the interface to show a temporary 'support needed' state
                localStorage.setItem('supportNeeded', 'true');
                renderRemindersView();
                
                // Clear 'support needed' state after 5 minutes (300,000 milliseconds)
                setTimeout(() => {
                    localStorage.removeItem('supportNeeded');
                    // Only update the view if the user is still on this screen
                    if (window.currentView === 'reminders') {
                        renderRemindersView();
                    }
                }, 300000); 

            } catch (error) {
                console.error("Error logging support request:", error);
                showMessage("An error occurred while logging the support request.");
            }
        };

        const renderRemindersView = () => {
            const isSupportNeeded = localStorage.getItem('supportNeeded') === 'true';

            const remindersContent = `
                <div id="reminders-view" class="space-y-8 p-2">
                    <h2 class="text-2xl font-bold text-dark-pink text-center mb-6">Today's Message to You 🌸</h2>
                    
                    <!-- Daily Reminder Card -->
                    <div class="bg-white p-6 rounded-3xl shadow-2xl border-4 border-accent-pink text-center">
                        <p class="text-3xl mb-4">✨</p>
                        <p class="text-lg font-semibold text-gray-800 leading-relaxed">
                            "${currentDailyReminder}"
                        </p>
                        <p class="mt-4 text-sm text-pink-600 font-medium">-- Your Gentle App</p>
                    </div>

                    <!-- Instant Support Notification -->
                    <div class="text-center mt-8">
                        ${isSupportNeeded ? `
                            <div class="bg-red-500 text-white p-4 rounded-xl shadow-lg animate-pulse">
                                <p class="text-xl font-bold">Alert: You Need Support Now! 🚨</p>
                                <p class="text-sm mt-1">Take a deep breath. Reach out to someone you trust.</p>
                                <button onclick="localStorage.removeItem('supportNeeded'); renderRemindersView()" class="mt-2 text-xs underline">Dismiss Alert</button>
                            </div>
                        ` : `
                            <button onclick="requestSupport()" class="bg-pink-300 text-pink-800 py-3 px-6 rounded-full font-bold text-lg shadow-md hover:bg-pink-400 transition-colors transform hover:scale-105">
                                I Need Support Now 🙏
                            </button>
                            <p class="mt-3 text-sm text-gray-600">Click if you feel like you need an immediate reminder for support.</p>
                        `}
                    </div>
                    
                    <!-- Display User ID for external support -->
                    <div class="p-3 bg-pink-100 rounded-lg text-center text-xs text-pink-700 mt-6">
                        <p class="font-bold mb-1">User ID (for data privacy and reference):</p>
                        <p id="user-id-display" class="break-words">${userId}</p>
                    </div>

                </div>
            `;
            document.getElementById('content-views').innerHTML = remindersContent;
            document.getElementById('user-id-display').textContent = userId;
        };


        // --- 3. Anti-Overthinking Section: Quotes and Activities Logic ---
        const stopQuotes = [
            { quote: "Turn off the movie in your head! You are safe now.", source: "Calmness Wisdom" },
            { quote: "Stop trying to solve problems that haven't happened yet.", source: "Ancient Wisdom" },
            { quote: "Overthinking is wasting energy on the past or future. Focus on the moment.", source: "Law of Presence" },
            { quote: "What you feel is not necessarily the truth. Separate feeling from action.", source: "Anti-Anxiety" },
            { quote: "Will this matter in a year? If not, let it go now.", source: "Time Perspective" },
        ];
        
        let currentQuoteIndex = 0;
        let breathInterval = null;
        let breathCount = 0;
        const breathPhases = ["Inhale (4 seconds) 😮‍💨", "Hold (4 seconds) ⏸️", "Exhale (6 seconds) 😌"];
        const breathDuration = [4000, 4000, 6000]; 

        window.startBreathExercise = () => {
            const startBtn = document.getElementById('start-breath-btn');
            
            if (breathInterval) {
                // Stop the exercise
                clearInterval(breathInterval);
                breathInterval = null;
                document.getElementById('breath-status').innerHTML = '<p class="text-lg font-medium">Stop exercise cancelled. Start again.</p>';
                startBtn.textContent = 'Start Breathing Exercise 🧘‍♀️';
                startBtn.classList.remove('bg-red-500', 'hover:bg-red-600');
                startBtn.classList.add('bg-accent-pink', 'hover:bg-pink-700');
                return;
            }

            // Start the exercise
            startBtn.textContent = 'Stop Exercise 🛑';
            startBtn.classList.remove('bg-accent-pink', 'hover:bg-pink-700');
            startBtn.classList.add('bg-red-500', 'hover:bg-red-600');
            
            breathCount = 0;
            let phaseIndex = 0;
            
            const runPhase = () => {
                const phase = breathPhases[phaseIndex % breathPhases.length];
                const duration = breathDuration[phaseIndex % breathPhases.length];

                if (phaseIndex % breathPhases.length === 0) {
                    breathCount++;
                }

                document.getElementById('breath-status').innerHTML = `
                    <p class="text-3xl font-bold">${phase}</p>
                    <p class="text-sm mt-2 text-pink-600">Cycle No.: ${Math.floor(breathCount)}</p>
                `;

                // Set a timeout for the next phase
                setTimeout(() => {
                    phaseIndex++;
                    if (breathInterval) { 
                        runPhase();
                    }
                }, duration);
            };

            // Start execution and set a dummy interval to keep the reference
            runPhase();
            breathInterval = setInterval(() => {}, 100000); 
        };

        window.nextQuote = () => {
            currentQuoteIndex = (currentQuoteIndex + 1) % stopQuotes.length;
            renderOverthinkingView();
        };

        const renderOverthinkingView = () => {
            const quote = stopQuotes[currentQuoteIndex];
            
            // Stop the breathing exercise when switching views
            if (breathInterval) {
                clearInterval(breathInterval);
                breathInterval = null;
            }

            const overthinkingContent = `
                <div id="overthinking-view" class="space-y-6">
                    <h2 class="text-2xl font-bold text-dark-pink text-center mb-6">Anti-Overthinking 🚫</h2>

                    <!-- Stop Quotes Card -->
                    <div class="bg-white p-6 rounded-2xl shadow-lg border-2 border-pink-400 text-center relative">
                        <svg onclick="nextQuote()" class="h-6 w-6 absolute top-3 right-3 text-pink-500 cursor-pointer hover:text-pink-700 transition-colors" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" title="Another Quote">
                             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.916 8.916 0 0110.22 17H8l-3 3 3 3h2.22A9 9 0 0021 12.001v-.01m-1.74-2.82l-3-3m0 0l-3 3" />
                        </svg>
                        <p class="text-lg font-bold text-pink-700 mt-4">Stop Thinking Words</p>
                        <p class="text-2xl italic text-gray-800 mt-3 leading-relaxed">
                            "${quote.quote}"
                        </p>
                        <p class="mt-4 text-sm text-gray-500 font-medium">— ${quote.source}</p>
                    </div>
                    
                    <!-- Mind Calming Activity: Breathing Exercise -->
                    <div class="bg-soft-pink p-5 rounded-2xl shadow-lg border border-pink-300 text-center space-y-4">
                        <h3 class="text-xl font-semibold text-pink-600">Mind Calming Exercise (Breathing) 🌬️</h3>
                        <p class="text-gray-700">Focus on your breath. This exercise grounds you in the present moment.</p>
                        
                        <div id="breath-status" class="bg-white p-6 rounded-xl shadow-inner border border-pink-200 min-h-[100px] flex flex-col justify-center items-center text-gray-800 transition-all duration-500">
                             <p class="text-lg font-medium">Ready to start?</p>
                        </div>

                        <button id="start-breath-btn" onclick="startBreathExercise()" class="bg-accent-pink text-white py-3 px-6 rounded-full font-bold shadow-md hover:bg-pink-700 transition-colors transform hover:scale-105">
                            Start Breathing Exercise 🧘‍♀️
                        </button>
                    </div>

                </div>
            `;
            document.getElementById('content-views').innerHTML = overthinkingContent;
        };


        // --- View Switching Logic ---
        window.currentView = 'reminders';

        window.switchView = (viewName) => {
            // Stop breathing exercise when switching views
            if (breathInterval) {
                clearInterval(breathInterval);
                breathInterval = null;
            }

            window.currentView = viewName;
            
            // Remove and add active class to navigation buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active', 'text-accent-pink', 'bg-pink-100');
                btn.classList.add('text-pink-400', 'hover:bg-pink-100');
            });

            const activeBtn = document.getElementById(`nav-${viewName}`);
            if (activeBtn) {
                activeBtn.classList.remove('text-pink-400', 'hover:bg-pink-100');
                activeBtn.classList.add('text-accent-pink', 'bg-pink-100', 'active');
            }

            // Display the appropriate content
            if (viewName === 'reminders') {
                renderRemindersView();
            } else if (viewName === 'journal') {
                renderJournalView();
            } else if (viewName === 'overthinking') {
                renderOverthinkingView();
            }
        };

        // Initialize the app upon page load
        window.onload = initializeFirebase;

    </script>
</body>
</html>


